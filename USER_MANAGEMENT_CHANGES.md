# עדכון מערכת ניהול משתמשים - סיכום שינויים

תאריך: פברואר 2026

## מה השתנה?

### 1. יצירת משתמשים חדשים - ללא שליחת מייל

**לפני:**
- כאשר מנהל הוסיף משתמש חדש, המערכת שלחה מייל עם פרטי הכניסה
- המשתמשים נשמרו רק במצב דמו (לא ב-Supabase)

**אחרי:**
- המנהל מקבל את פרטי הכניסה ישירות בממשק (toast הודעה)
- המשתמשים נשמרים ב-Supabase בטבלת `users`
- אין שליחת מיילים
- המנהל אחראי להעביר את הפרטים למשתמש החדש

### 2. סיסמאות חכמות

**סיסמת ברירת מחדל חדשה:**
- במקום `demo123` או `temp123456789`
- הסיסמה היא: `[שם_ראשון]123`
- דוגמה: אם השם הוא "יוסי לוי", הסיסמה תהיה `יוסי123`

### 3. תמיכה בתמונת פרופיל

**הוספה:**
- אפשרות להעלות תמונת פרופיל בזמן יצירת משתמש
- תמיכה בהעלאת קובץ או קישור URL

## קבצים ששונו

### קבצי קוד
1. `/components/user-management.tsx` - שינוי תהליך יצירת משתמשים
2. `/app/api/auth/invite/route.ts` - עדכון API לשמירה ב-Supabase
3. `/scripts/001_create_tables.sql` - עדכון טבלת users

### קבצים חדשים
1. `/scripts/007_add_password_column.sql` - הוספת עמודת password
2. `/scripts/008_users_rls_policies.sql` - הגדרת RLS policies
3. `/USER_MANAGEMENT_SETUP.md` - מדריך הגדרה מפורט
4. `/QUICK_USER_GUIDE.md` - מדריך מהיר למנהלים
5. `/USER_MANAGEMENT_CHANGES.md` - קובץ זה

## הוראות התקנה

### שלב 1: עדכון מסד הנתונים

הרץ את הסקריפטים הבאים ב-Supabase SQL Editor (לפי הסדר):

1. **אם זו התקנה ראשונה:**
   ```sql
   -- הרץ את scripts/001_create_tables.sql
   ```

2. **אם הטבלה כבר קיימת ללא עמודת password:**
   ```sql
   -- הרץ את scripts/007_add_password_column.sql
   ```

3. **הגדרת הרשאות:**
   ```sql
   -- הרץ את scripts/008_users_rls_policies.sql
   ```

### שלב 2: פרוס את הקוד

```bash
# אין צורך להתקין תלויות חדשות
# פשוט פרוס את הקוד המעודכן
npm run build
npm start
```

או פרוס ל-Vercel/Netlify כרגיל.

### שלב 3: בדיקה

1. התחבר כמנהל מערכת
2. נסה להוסיף משתמש חדש
3. ודא שאתה רואה הודעה עם פרטי הכניסה
4. נסה להתחבר עם המשתמש החדש

## איך להשתמש?

### הוספת משתמש חדש (למנהלים)

1. לחץ על "ניהול משתמשים"
2. מלא:
   - שם מלא (חובה)
   - אימייל (חובה)
   - סיסמה (אופציונלי)
   - תמונת פרופיל (אופציונלי)
   - הרשאות (admin/user/viewer)
3. לחץ "הוסף משתמש"
4. **שמור את פרטי הכניסה שמוצגים!**
5. העבר את הפרטים למשתמש החדש

### דוגמה מלאה

נניח שאתה רוצה להוסיף את דנה כהן:

```
שם: דנה כהן
אימייל: dana@company.com
סיסמה: (השאר ריק)
הרשאות: user
```

המערכת תיצור משתמש עם:
```
אימייל: dana@company.com
סיסמה: דנה123
```

אתה צריך להעביר לדנה:
- "היי דנה, נוצר עבורך חשבון במערכת"
- "אימייל: dana@company.com"
- "סיסמה: דנה123"

## אבטחה

### הערות חשובות

⚠️ **למטרות הדגמה בלבד**
- הסיסמאות מאוחסנות בצורה פשוטה (plain text)
- זה מתאים למערכות פנימיות או דמו

🔐 **לפני ייצור (Production):**
1. הוסף הצפנת סיסמאות (bcrypt/argon2)
2. שקול שימוש ב-Supabase Auth
3. הוסף אימות דו-שלבי
4. הגדר מדיניות סיסמאות חזקה

## פתרון בעיות

### שגיאה: "כשל ביצירת משתמש"

**סיבות אפשריות:**
- טבלת `users` לא קיימת
- חסרה עמודת `password`
- בעיית הרשאות RLS
- אין חיבור ל-Supabase

**פתרון:**
1. הרץ את הסקריפטים ב-Supabase
2. בדוק ב-Supabase Table Editor שהטבלה קיימת
3. ודא שיש חיבור לאינטרנט

### הסיסמה לא עובדת

**פתרון:**
- ודא שהעברת את הסיסמה הנכונה
- בדוק אם יש רווחים מיותרים
- נסה ליצור משתמש חדש

### פרטי הכניסה לא מוצגים

**פתרון:**
- בדוק את ה-console (F12)
- ודא שה-API route עובד
- רענן את הדף ונסה שוב

## תמיכה

לשאלות או בעיות:
1. בדוק את הקונסול בדפדפן (F12 → Console)
2. בדוק את הלוגים ב-Supabase Dashboard
3. קרא את `/USER_MANAGEMENT_SETUP.md` למידע מפורט
4. קרא את `/QUICK_USER_GUIDE.md` למדריך מהיר

## גרסה

- **גרסה נוכחית:** 2.0
- **תאריך:** פברואר 2026
- **מפתח:** מערכת ניהול משימות
