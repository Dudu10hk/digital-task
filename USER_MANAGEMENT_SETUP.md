# הוראות הגדרת מסד נתונים לניהול משתמשים

## סקירה כללית
המערכת מאפשרת למנהל להוסיף משתמשים חדשים ישירות מהממשק. המשתמשים נשמרים בטבלת `users` ב-Supabase.

## הגדרה ראשונית

### שלב 1: הוספת עמודת סיסמה לטבלת users

אם טבלת `users` שלך עדיין לא כוללת עמודת `password`, הרץ את הסקריפט הבא ב-Supabase SQL Editor:

```sql
-- הוסף עמודת password לטבלת users
ALTER TABLE users ADD COLUMN IF NOT EXISTS password TEXT;

-- עדכן משתמשים קיימים עם סיסמת ברירת מחדל
UPDATE users 
SET password = 'demo123' 
WHERE password IS NULL OR password = '';

-- הפוך את העמודה לחובה
ALTER TABLE users ALTER COLUMN password SET NOT NULL;
```

**או**, הרץ את הסקריפט המוכן: `scripts/007_add_password_column.sql`

### שלב 2: וודא שטבלת users קיימת

אם טבלת users עדיין לא קיימת, הרץ את: `scripts/001_create_tables.sql`

## איך זה עובד?

### הוספת משתמש חדש

1. המנהל נכנס לממשק "ניהול משתמשים"
2. ממלא את הפרטים:
   - **שם מלא** (חובה)
   - **אימייל** (חובה)
   - **סיסמה** (אופציונלי - ברירת מחדל: `[שם_ראשון]123`)
   - **תמונת פרופיל** (אופציונלי)
   - **הרשאות** (admin/user/viewer)

3. לאחר יצירת המשתמש, המערכת **תציג הודעה עם פרטי ההתחברות**:
   - אימייל
   - סיסמה
   
   ⚠️ **חשוב:** פרטים אלו יוצגו רק פעם אחת! יש לשמור אותם ולהעביר למשתמש החדש.

### כניסה של משתמש חדש

המשתמש החדש יכול להיכנס למערכת באמצעות:
- **אימייל**: כפי שהוזן על ידי המנהל
- **סיסמה**: כפי שהוגדרה או הסיסמה ברירת המחדל

## אבטחה

⚠️ **הערת אבטחה חשובה:**

המערכת הנוכחית מאחסנת סיסמאות בצורה פשוטה (plain text) למטרות הדגמה בלבד.

**לפני העברה לייצור (Production):**

1. העבר להצפנת סיסמאות עם bcrypt או argon2
2. שקול שימוש ב-Supabase Auth המובנה
3. הוסף אימות דו-שלבי (2FA)
4. הגדר מדיניות סיסמאות חזקה

## בעיות נפוצות ופתרונות

### בעיה: "Error creating user" / "שגיאה ביצירת משתמש"

**פתרון:**
1. ודא שטבלת `users` קיימת ב-Supabase
2. ודא שעמודת `password` קיימת בטבלה
3. בדוק שה-RLS (Row Level Security) מאפשר INSERT על טבלת users
4. ודא שיש לך הרשאות admin

### בעיה: "משתמש עם אימייל זה כבר קיים"

**פתרון:**
- האימייל כבר רשום במערכת
- שנה את האימייל או מחק את המשתמש הקיים

### בעיה: פרטי הכניסה לא מוצגים אחרי יצירת משתמש

**פתרון:**
1. בדוק את ה-console בדפדפן (F12) לשגיאות
2. ודא שה-API route עובד: `/api/auth/invite`
3. רענן את הדף ונסה שוב

## סקריפטים זמינים

- `scripts/001_create_tables.sql` - יצירת טבלת users ראשונית
- `scripts/007_add_password_column.sql` - הוספת עמודת password
- `scripts/003_seed_demo_data.sql` - נתוני דמו

## תמיכה נוספת

אם אתה נתקל בבעיות, בדוק את:
1. הקונסול בדפדפן (F12 → Console)
2. לוגים ב-Supabase Dashboard
3. טבלת users ב-Supabase Table Editor
